<html>
<head>
<title>Programming SecureXML Home</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--webbot bot="PurpleText" PREVIEW="Meta Data Starts Here" -->
<meta name="title" content="Infomosaic: XML Signature">
<meta name="keywords" content="XML security, XML Signature, Digital Signature, Web Service Security, XML Signature ActiveX, XML Security Made Easy, Secure Web Application, smart card, services and products for secure e-business,">
<meta name="description" content="Infomosaic provides XML Security Software. SecureXML is the first C-Language implementation of the W3C XML Digital Signature standard. Its small 
              code size is highly optimized making it most appropriate for high 
              volume XML transaction applications">
<META NAME="abstract" CONTENT="Infomosaic provides XML Security Software. SecureXML is the first C-Language 
              implementation of the W3C XML Digital Signature standard. Its small 
              code size is highly optimized making it most appropriate for high 
              volume XML transaction applications">
<META NAME="revisit-after" CONTENT="3 days">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<!--webbot bot="PurpleText" PREVIEW="Meta Data Ends Here" -->
</head>
<body bgcolor="#FFFFFF">
<div align="left"></div>
<table border="0" align="left" height="689" cellspacing="0" width="730" cellpadding="0">
  <tr valign="top" align="left"> 
    <td colspan="2" height="177"> 
      <div align="left"><a href="../OnlineApps/index.html"> </a> 
        <table border="0" cellpadding="0" cellspacing="0" width="730">
          <!-- fwtable fwsrc="toplinks.png" fwbase="toplinks.jpg" fwstyle="Dreamweaver" fwdocid = "742308039" fwnested="1" -->
          <tr> 
            <td colspan="22"><img name="toplinks_r1_c1" src="../LocalWebApps/newimages/toplinks_r1_c1.jpg" width="730" height="133" border="0"></td>
          </tr>
        </table>
        <hr color="#FF9933">
      </div>
    </td>
  </tr>
  <tr> 
    <td width="100" height="548" valign="top" background="../OnlineApps/orangeswipe.gif"> 
      <p><a href="index.htm"><font color="#009999"><b>Programming Home</b></font></a></p>
    </td>
    <td height="548" valign="top" width=600> 
      <table width="90%" border="0" align="center">
        <tr> 
          <td><font size="3" face="Arial, Helvetica, sans-serif"><b><font color="#009999">Using 
            <font color="#FF9933">S</font>ecure<font color="#FF9933">X</font>ML 
            from Microsoft Visual C 6.0 </font></b></font> 
            <p>The C and C++ language sample applications are included in the 
            </p>
            <p><font color="#FF0000">C:\Program Files\Infomosaic\SecureXML\Programming\Programming.dsw</font> 
              Visual Studio workspace. Please open Programming.dsw workspace from 
              Visual C++ 6.0 environment and look at the SecureXMLFromC project. 
              The source code of <font color="#FF0000">TrySign.c</font> from this 
              project is shown below.</p>
            <p>Before compiling any C programs, please make sure that XMLSign.idl 
              file is included in your project and it is part of the build process. 
              You may have to manually specify the build command for the idl file 
              if one is not added automatically by Visual Studio. You can do this 
              by specifying midl $(InputPath) for the custom build command and 
              an output directory for XMLSign.idl file by right clicking XMLSign.idl 
              in the FileView and choosing Settings.</p>
            <p><font color="#009900">/* Defining COBJMACROS allows you to call 
              the MIDL generated wrappers for SecureXML methods and properties.<br>
              * It makes using SecureXML from C a little easier.<br>
              */</font><br>
              #define COBJMACROS</p>
            <p>#include &lt;stdio.h&gt;<br>
              <font color="#009900">/* The following two files are generated by 
              Visual Studio provided IDL compiler: MIDL */</font><br>
              #include &quot;XMLSign.h&quot; <br>
              #include &quot;XMLSign_i.c&quot;</p>
            <p>void main()<br>
              {</p>
            <blockquote> 
              <p> HRESULT hr;<br>
                IUnknown *pUnknown;<br>
                ISignature *pSig;<br>
                BSTR tmpFileName;<br>
                BSTR inputData;<br>
                LONG status;<br>
                int signatureCount;<br>
                int certificateCount;<br>
                int referenceCount;<br>
                BSTR signerName;<br>
                BSTR certIssuer;<br>
                BSTR docURI;<br>
                BSTR sigId;<br>
                int i,j;</p>
              <p> <font color="#009900">/* Initialize Windows COM Infrastructure 
                */</font><br>
                hr = CoInitialize(NULL);<br>
                if (FAILED(hr)) {<br>
                printf(&quot;%s&quot;,&quot;CoInitialize failed.\n&quot;);<br>
                exit(0);<br>
                }</p>
              <p> <font color="#009900">/* Create an instance of SecureXML Digital 
                Signature */</font><br>
                hr = CoCreateInstance(&amp;CLSID_Signature, NULL, CLSCTX_INPROC_SERVER, 
                <br>
                &amp;IID_IUnknown, (void **) &amp;pUnknown);<br>
                if (FAILED(hr)) {<br>
                printf(&quot;%s&quot;,&quot;CoCreateInstance failed.\n&quot;);<br>
                exit(0);<br>
                }</p>
              <p> <font color="#009900">/* Create a XMLSign.Signature Object and 
                obtain it's handle */</font><br>
                hr = ISignature_QueryInterface(pUnknown, &amp;IID_ISignature, 
                (void **) &amp;pSig);<br>
                if (FAILED(hr)) {<br>
                printf(&quot;%s&quot;,&quot;QueryInterface failed.\n&quot;);<br>
                exit(0);<br>
                }</p>
              <p> <font color="#009900">/* Now pSig is a pointer to a XMLSign.Signature 
                Object */<br>
                /* Since we don't want any more Signature objects, release the 
                handle to SecureXML */</font><br>
                ISignature_Release(pUnknown);</p>
              <p> <font color="#009900">/* Lets invoke some methods and set a 
                few properties to make sure we can use it */</font><br>
                hr = <font color="#FF0000">ISignature_ReadAll</font>(pSig, L&quot;TwoSignature.xml&quot;, 
                &amp;inputData);<br>
                if (FAILED(hr)) {<br>
                printf(&quot;%s&quot;,&quot;ReadAll failed.\n&quot;);<br>
                exit(0);<br>
                }</p>
              <p> <font color="#009900">/* Verify the signature from the above 
                file */</font><br>
                hr = <font color="#FF0000">ISignature_VerifyXMLStr</font>(pSig, 
                inputData, &amp;status);<br>
                if (status) {</p>
              <blockquote> 
                <p>printf(&quot;Signature Verified Successfully\n&quot;);<br>
                  <font color="#FF0000">ISignature_get_SignatureCount</font>(pSig, 
                  &amp;signatureCount);<br>
                  printf(&quot;Signature Count = %d\n&quot;, signatureCount);<br>
                  for (i=0; i &lt; signatureCount; i++) {<br>
                  <font color="#FF0000">ISignature_get_SignatureID</font>(pSig, 
                  i, &amp;sigId);<br>
                  <font color="#FF0000">ISignature_get_SignerSubject</font>(pSig, 
                  sigId, &amp;signerName);<br>
                  <font color="#FF0000">ISignature_get_CertIssuer</font>(pSig, 
                  sigId, &amp;certIssuer);<br>
                  printf(&quot;Signature #%d, Signer Name = %ws\n\n&quot;, i, 
                  signerName);<br>
                  printf(&quot;Signature #%d, Certificate Issued By %ws\n\n&quot;, 
                  i, certIssuer);<br>
                  <font color="#FF0000">ISignature_get_TotalUriCount</font>(pSig, 
                  &amp;referenceCount);<br>
                  for (j=0; j &lt; referenceCount; j++) {<br>
                  <font color="#FF0000">ISignature_get_DocumentURI</font>(pSig, 
                  i, j, &amp;docURI);<br>
                  printf(&quot;Signature #%d Document URI #%d = %ws\n&quot;, i, 
                  j, docURI);<br>
                  <font color="#009900">/* Release memory allocated by SecureXML 
                  */</font><br>
                  SysFreeString(docURI);</p>
              </blockquote>
              <p>}</p>
              <p><br>
                <font color="#009900">/* Release memory allocated by SecureXML 
                */</font><br>
                SysFreeString(sigId);<br>
                SysFreeString(signerName);<br>
                SysFreeString(certIssuer);<br>
                }<br>
                }</p>
              <p> hr = <font color="#FF0000">ISignature_get_CertificateCount</font>(pSig, 
                &amp;certificateCount);<br>
                printf(&quot;You have %d PKI certificates installed in your computer\n&quot;, 
                certificateCount);<br>
                if (status == 0) {<br>
                printf(&quot;Signature verification failed\n&quot;);<br>
                }</p>
              <p> <font color="#009900">/* Lets create a signature */</font><br>
                hr = <font color="#FF0000">ISignature_put_SignatureID</font>(pSig, 
                0, L&quot;MySignature&quot;);<br>
                hr = <font color="#FF0000">ISignature_put_EnvelopingFlag</font>(pSig, 
                2);<font color="#009900"> /* Create Enveloped Signature */</font><br>
                hr = <font color="#FF0000">ISignature_put_PhysicalSignatureUsage</font>(pSig, 
                2); <font color="#009900">/* Lets capture a live signature image 
                */</font><br>
                hr =<font color="#FF0000"> ISignature_Sign</font>(pSig, L&quot;catalog.xml&quot;, 
                &amp;tmpFileName); <font color="#009900">/* Sign the XML contained 
                in catalog.xml file */</font></p>
              <p> hr = <font color="#FF0000">ISignature_put_OverwriteFile</font>(pSig, 
                1);<font color="#009900"> /* Force file overwrite */ </font><br>
                hr = <font color="#FF0000">ISignature_SaveXMLSignature</font>(pSig, 
                L&quot;catalogSigned.xml&quot;);<br>
                printf(&quot;Signature saved as catalogSigned.xml\n&quot;);</p>
              <p> <font color="#009900">/* Lets verify the signature we just created 
                */</font><br>
                hr = <font color="#FF0000">ISignature_Verify</font>(pSig, L&quot;catalogSigned.xml&quot;, 
                &amp;status);<br>
                if (status) {<br>
                <font color="#FF0000">ISignature_get_SignatureCount</font>(pSig, 
                &amp;status);<br>
                printf(&quot;Signature Verified Successfully\n&quot;);<br>
                printf(&quot;Signature Count = %d\n&quot;, status);<br>
                }<br>
                <font color="#009900">/* Release memory allocated by SecureXML 
                */</font><br>
                SysFreeString(inputData);<br>
                SysFreeString(tmpFileName);<br>
                <font color="#FF0000">ISignature_Release</font>(pSig);<font color="#009900"> 
                /* We are done */</font><br>
                CoUninitialize();</p>
            </blockquote>
            <p>}</p>
          </td>
        </tr>
      </table>
      <p>&nbsp;</p>
      <p><font size="1" face="Arial, Helvetica, sans-serif"><b><br>
        </b></font></p>
    </td>
  </tr>
  <tr> 
    <td colspan="2" height="46" valign="top" background="../OnlineApps/orangeswipe.gif"> 
      <div align="center">All contents are Copyright © 2000--2002 Infomosaic Corporation. 
        All rights reserved. <br>
        Page last updated on 
        <!-- #BeginDate format:fcAm1 -->Thursday, January 2, 2003<!-- #EndDate -->
      </div>
    </td>
  </tr>
</table>
</body>
</html>
